<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MHHS Interface Explorer | Enhanced Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Base styles and theme variables */
        body { font-family: 'Inter', sans-serif; overscroll-behavior-y: none; }
        :root {
            --eon-red: #FF4822; --birch: #FAF6F4; --white: #FFFFFF; --dark-purple: #36164A;
            --purple: #5E0D98; --data-sun: #FFDE00; --data-gas-off: #9254FF; --data-leaf: #1AE570;
        }
        .gradient-bg { background: linear-gradient(135deg, var(--birch) 0%, #f0e9e6 100%); }
        .glass { backdrop-filter: blur(16px) saturate(180%); background: rgba(255, 255, 255, 0.75); border: 1px solid rgba(255, 255, 255, 0.2); }
        .btn-primary { background-color: var(--eon-red); color: var(--white); transition: background-color 0.3s; }
        .btn-primary:hover { background-color: #e0401f; }
        .favorite-btn.favorited svg { fill: var(--data-sun); stroke: var(--data-sun); }
        .modal-content { animation: slide-up 0.3s ease-out; }
        @keyframes slide-up { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body class="gradient-bg text-gray-800">
    <div class="container mx-auto p-4 md:p-6 lg:p-8">
        <header class="mb-6 text-center">
            <h1 class="text-4xl font-bold text-gray-900">MHHS Interface Explorer</h1>
            <p class="text-lg text-gray-600 mt-2">Search, filter, and explore MHHS interface data items.</p>
        </header>

        <!-- Search and Filter Controls -->
        <div class="mb-6 p-4 rounded-lg shadow-md glass">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <input type="text" id="searchInput" placeholder="Search by name, ID, or description..." class="md:col-span-2 p-2 border rounded-md focus:ring-2 focus:ring-eon-red focus:outline-none">
                <div class="flex space-x-2">
                    <button id="filterBtn" class="w-full bg-white p-2 border rounded-md hover:bg-gray-100">Filters</button>
                    <button id="exportBtn" class="w-full bg-white p-2 border rounded-md hover:bg-gray-100">Export</button>
                </div>
            </div>
        </div>

        <!-- Table Display Area -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Length</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="interfaceTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Rows will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Details Modal -->
    <div id="detailsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-start">
                    <h2 id="modalTitle" class="text-2xl font-bold"></h2>
                    <button onclick="closeModal('detailsModal')" class="text-gray-500 hover:text-gray-800">&times;</button>
                </div>
                <div id="modalBody" class="mt-4 prose max-w-none"></div>
            </div>
        </div>
    </div>

    <!-- Filter Modal -->
    <div id="filterModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4">
         <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="p-6">
                <h2 class="text-xl font-bold mb-4">Advanced Filters</h2>
                <!-- Filter options will be added here -->
                <div class="mt-6 flex justify-end space-x-2">
                    <button onclick="applyModalFilters()" class="btn-primary px-4 py-2 rounded-md">Apply</button>
                    <button onclick="closeModal('filterModal')" class="bg-gray-200 px-4 py-2 rounded-md">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Export Modal -->
    <div id="exportModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-sm">
            <div class="p-6">
                <h2 class="text-xl font-bold mb-4">Export Data</h2>
                <p class="mb-4">Select the format to export the current view.</p>
                <div class="space-y-2">
                    <button onclick="exportData('csv')" class="w-full text-left bg-gray-100 p-2 rounded-md hover:bg-gray-200">CSV</button>
                    <button onclick="exportData('json')" class="w-full text-left bg-gray-100 p-2 rounded-md hover:bg-gray-200">JSON</button>
                </div>
                <div class="mt-6 flex justify-end">
                    <button onclick="closeModal('exportModal')" class="bg-gray-200 px-4 py-2 rounded-md">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- State Management ---
        const state = {
            interfaces: [],
            filteredInterfaces: [],
            favorites: new Set(JSON.parse(localStorage.getItem('favorites') || '[]')),
            currentFilter: 'all',
            currentSearchTerm: '',
            advancedFilters: {}
        };

        // --- Data Fetching and Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            fetchInterfaces();
            setupEventListeners();
        });

        async function fetchInterfaces() {
            try {
                const response = await fetch('interfaceData.json');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                state.interfaces = data;
                applyFilters();
            } catch (error) {
                console.error("Could not fetch interface data:", error);
                document.getElementById('interfaceTableBody').innerHTML = `<tr><td colspan="6" class="text-center p-4">Error loading data.</td></tr>`;
            }
        }

        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', handleSearch);
            document.getElementById('filterBtn').addEventListener('click', () => openModal('filterModal'));
            document.getElementById('exportBtn').addEventListener('click', () => openModal('exportModal'));
        }

        // --- Filtering and Searching ---
        function applyFilters() {
            let results = [...state.interfaces];
            
            // Search filter
            const searchTerm = state.currentSearchTerm.toLowerCase();
            if (searchTerm) {
                results = results.filter(item =>
                    item.name.toLowerCase().includes(searchTerm) ||
                    item.id.toLowerCase().includes(searchTerm) ||
                    item.description.toLowerCase().includes(searchTerm)
                );
            }

            // TODO: Add advanced filter logic here

            state.filteredInterfaces = results;
            renderTable();
        }

        function handleSearch(event) {
            state.currentSearchTerm = event.target.value;
            applyFilters();
        }

        // --- Rendering ---
        function renderTable() {
            const tableBody = document.getElementById('interfaceTableBody');
            if (state.filteredInterfaces.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="6" class="text-center p-4">No results found.</td></tr>`;
                return;
            }

            tableBody.innerHTML = state.filteredInterfaces.map(item => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${escapeHtml(item.id)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800">${escapeHtml(item.name)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${escapeHtml(item.type)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${escapeHtml(item.length)}</td>
                    <td class="px-6 py-4 text-sm text-gray-500 truncate" style="max-width: 300px;">${escapeHtml(item.description)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="showDetails('${item.id}')" class="text-indigo-600 hover:text-indigo-900">Details</button>
                        <button onclick="toggleFavorite('${item.id}')" class="favorite-btn ml-4 ${state.favorites.has(item.id) ? 'favorited' : ''}" title="Toggle Favorite">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.196-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.783-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path></svg>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // --- Modal Logic ---
        function openModal(modalId) { document.getElementById(modalId).classList.remove('hidden'); document.getElementById(modalId).classList.add('flex'); }
        function closeModal(modalId) { document.getElementById(modalId).classList.add('hidden'); document.getElementById(modalId).classList.remove('flex'); }

        function showDetails(itemId) {
            const item = state.interfaces.find(i => i.id === itemId);
            if (!item) return;

            document.getElementById('modalTitle').innerText = `${item.name} (${item.id})`;
            let bodyContent = `
                <p><strong>Description:</strong> ${escapeHtml(item.description)}</p>
                <p><strong>Type:</strong> ${escapeHtml(item.type)}</p>
                <p><strong>Length:</strong> ${escapeHtml(item.length)}</p>
            `;
            if (item.example) {
                bodyContent += `<p><strong>Example:</strong> <code>${escapeHtml(item.example)}</code></p>`;
            }
            if (item.enumValues) {
                bodyContent += `<strong>Allowed Values:</strong><ul>${item.enumValues.map(v => `<li>${escapeHtml(v)}</li>`).join('')}</ul>`;
            }
            document.getElementById('modalBody').innerHTML = bodyContent;
            openModal('detailsModal');
        }

        // --- Actions ---
        function toggleFavorite(itemId) {
            if (state.favorites.has(itemId)) {
                state.favorites.delete(itemId);
            } else {
                state.favorites.add(itemId);
            }
            localStorage.setItem('favorites', JSON.stringify([...state.favorites]));
            renderTable(); // Re-render to update the favorite icon
        }
        
        function exportData(format) {
            let data;
            let filename;
            let mimeType;
            
            const headers = ['id', 'name', 'type', 'length', 'description', 'example'];
            
            switch (format) {
                case 'csv':
                    let csvContent = headers.join(',') + '\\n';
                    state.filteredInterfaces.forEach(item => {
                        const row = headers.map(header => `"${(item[header] || '').toString().replace(/"/g, '""')}"`);
                        csvContent += row.join(',') + '\\n';
                    });
                    data = csvContent;
                    filename = 'mhhs_data.csv';
                    mimeType = 'text/csv;charset=utf-8;';
                    break;
                    
                case 'json':
                    data = JSON.stringify({
                        meta: {
                            exportedAt: new Date().toISOString(),
                            filter: state.currentFilter,
                            searchTerm: state.currentSearchTerm,
                            advancedFilters: state.advancedFilters
                        },
                        results: state.filteredInterfaces
                    }, null, 2);
                    filename = 'mhhs_filtered_results.json';
                    mimeType = 'application/json';
                    break;
                    
                default:
                    return;
            }
            
            downloadFile(data, filename, mimeType);
        }

        function downloadFile(data, filename, mimeType) {
            const blob = new Blob([data], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // Utility Functions
        function escapeHtml(text) {
            if (text === null || typeof text === 'undefined') return '';
            const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '\"': '&quot;', "'": '&#039;' };
            return text.toString().replace(/[&<>\"']/g, m => map[m]);
        }

        // Global functions for HTML onclick handlers
        window.toggleFavorite = toggleFavorite;
        window.showDetails = showDetails;
        window.closeModal = closeModal;
        window.openModal = openModal;
        window.exportData = exportData;

    </script>
    
    <!-- This new script tag links to your external form builder logic -->
    <script src="formBuilder.js"></script>

</body>
</html>
